<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Настройка Kubernetes | Руководство по DevOps</title>
    <link rel="stylesheet" href="../css/styles.css">
    <!-- Подключение Font Awesome -->
    <link rel="stylesheet" href="../assets/fonts/fontawesome/css/all.min.css">
</head>

<body>
    <!-- Навигация (хлебные крошки) -->
    <nav class="breadcrumb">
        <ul>
            <li class="breadcrumb-item"><a href="../index.html">Главная</a></li>
            <li class="breadcrumb-item">Роль: DevOps</li>
            <li class="breadcrumb-item"><a href="introduction.html">Введение</a></li>
            <li class="breadcrumb-item"><a href="containerization.html">Контейнеризация приложений</a></li>
            <li class="breadcrumb-item active">Настройка Kubernetes</li>
        </ul>
    </nav>

    <main>
        <h1><i class="fas fa-network-wired"></i> Настройка Kubernetes</h1>
        <p><strong>Роль:</strong> DevOps</p>
        <p><strong>Уровень:</strong> Начинающий</p>

        <!-- Содержание -->
        <section>
            <!-- Главный шаг 1 -->
            <button class="accordion"><i class="fas fa-step-forward"></i> Шаг 1: Установка kubectl</button>
            <div class="panel">
                <p><strong>На какой машине:</strong> Удалённая машина (FreeBSD виртуальная машина)</p>

                <h3>Описание</h3>
                <p>kubectl — это командная утилита для управления Kubernetes-кластером. В этом шаге мы установим kubectl
                    на FreeBSD.</p>

                <h3>Предварительные требования</h3>
                <ul>
                    <li>Установленная и настроенная система FreeBSD.</li>
                    <li>Пользователь с правами суперпользователя.</li>
                    <li>Доступ к интернету с виртуальной машины.</li>
                </ul>

                <!-- Подшаги -->
                <div class="sub-steps">
                    <!-- Подшаг 1 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Установка kubectl через
                        pkg</button>
                    <div class="sub-panel">
                        <p>На FreeBSD kubectl можно установить через пакетный менеджер pkg.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Обновите базу данных пакетов:</li>
                            <div class="code-block">
                                <pre>
pkg update
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Установите kubectl:</li>
                            <div class="code-block">
                                <pre>
sudo pkg install -y kubectl
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <h4>Объяснение команды</h4>
                            <ul>
                                <li><code>pkg install</code>: Команда для установки пакета.</li>
                                <li><code>-y</code>: Автоматически отвечает «Yes» на все запросы подтверждения.</li>
                                <li><code>kubectl</code>: Пакет kubectl.</li>
                            </ul>
                            <li>Проверьте версию kubectl:</li>
                            <div class="code-block">
                                <pre>
kubectl version --client
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Вывод должен содержать информацию о версии kubectl.</li>
                        </ol>
                    </div>
                </div>

                <h3>Чек-лист: Проверка установки kubectl</h3>
                <ul>
                    <li>Команда <code>kubectl version --client</code> выводит версию kubectl без ошибок.</li>
                </ul>

                <h3>Полезные ссылки</h3>
                <ul>
                    <li><a href="https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/" target="_blank">Официальная
                            документация по установке kubectl</a></li>
                </ul>
            </div>

            <!-- Главный шаг 2 -->
            <button class="accordion"><i class="fas fa-step-forward"></i> Шаг 2: Установка Minikube</button>
            <div class="panel">
                <p><strong>На какой машине:</strong> Удалённая машина (FreeBSD виртуальная машина)</p>

                <h3>Описание</h3>
                <p>Minikube — это инструмент для запуска локального кластера Kubernetes. В этом шаге мы установим
                    Minikube на FreeBSD.</p>

                <h3>Предварительные требования</h3>
                <ul>
                    <li>Установленный kubectl.</li>
                    <li>Установленный Docker и настроенное окружение.</li>
                    <li>Виртуализация включена и поддерживается (VT-x или AMD-V).</li>
                </ul>

                <!-- Подшаги -->
                <div class="sub-steps">
                    <!-- Подшаг 1 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Скачивание Minikube</button>
                    <div class="sub-panel">
                        <p>На FreeBSD Minikube можно установить, скачав бинарный файл.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Перейдите в домашнюю директорию:</li>
                            <div class="code-block">
                                <pre>
cd ~
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Скачайте последний релиз Minikube:</li>
                            <div class="code-block">
                                <pre>
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-freebsd-amd64
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Переместите файл в директорию <code>/usr/local/bin</code> и переименуйте его в
                                <code>minikube</code>:
                            </li>
                            <div class="code-block">
                                <pre>
sudo mv minikube-freebsd-amd64 /usr/local/bin/minikube
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Установите права на выполнение:</li>
                            <div class="code-block">
                                <pre>
sudo chmod +x /usr/local/bin/minikube
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Проверьте установку Minikube:</li>
                            <div class="code-block">
                                <pre>
minikube version
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Вывод должен содержать информацию о версии Minikube.</li>
                        </ol>

                        <div class="info-block">
                            <p><strong><i class="fas fa-info-circle"></i> Примечание:</strong> На момент написания
                                данного руководства официальный бинарный файл Minikube для FreeBSD может быть
                                недоступен. В этом случае можно собрать Minikube из исходников или использовать
                                альтернативные решения.</p>
                        </div>
                    </div>

                    <!-- Подшаг 2 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Настройка драйвера Docker для
                        Minikube</button>
                    <div class="sub-panel">
                        <p>Minikube может использовать Docker в качестве драйвера виртуализации.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Убедитесь, что Docker запущен и работает:</li>
                            <div class="code-block">
                                <pre>
sudo service docker status
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Если Docker не запущен, запустите его:</li>
                            <div class="code-block">
                                <pre>
sudo service docker start
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Настройте окружение Docker для Minikube:</li>
                            <div class="code-block">
                                <pre>
minikube config set driver docker
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                        </ol>
                    </div>

                    <!-- Подшаг 3 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Запуск Minikube</button>
                    <div class="sub-panel">
                        <p>Теперь мы можем запустить локальный кластер Kubernetes с помощью Minikube.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Запустите Minikube:</li>
                            <div class="code-block">
                                <pre>
minikube start
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Дождитесь завершения процесса запуска. Это может занять несколько минут.</li>
                            <li>Проверьте статус кластера:</li>
                            <div class="code-block">
                                <pre>
kubectl cluster-info
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Вывод должен содержать информацию о работающем кластере Kubernetes.</li>
                        </ol>

                        <details>
                            <summary><strong>Проблемы с запуском Minikube</strong></summary>
                            <p><strong>Решение:</strong></p>
                            <ul>
                                <li>Убедитесь, что Docker работает корректно.</li>
                                <li>Проверьте наличие ошибок в выводе команды <code>minikube start</code>.</li>
                                <li>Попробуйте запустить Minikube с флагом увеличения подробности логов:
                                    <code>minikube start --v=7</code>.
                                </li>
                            </ul>
                        </details>

                        <div class="info-block">
                            <p><strong><i class="fas fa-exclamation-circle"></i> Важно:</strong> На FreeBSD могут
                                возникать сложности с запуском Minikube из-за особенностей системы и ограниченной
                                поддержки. Рассмотрите возможность использования Linux-системы или виртуальной машины с
                                Linux для работы с Kubernetes.</p>
                        </div>
                    </div>
                </div>

                <h3>Чек-лист: Проверка установки Minikube</h3>
                <ul>
                    <li>Команда <code>minikube version</code> выводит версию Minikube без ошибок.</li>
                    <li>Локальный кластер Kubernetes запущен и работает.</li>
                    <li>Команда <code>kubectl cluster-info</code> отображает информацию о кластере.</li>
                </ul>

                <h3>Полезные ссылки</h3>
                <ul>
                    <li><a href="https://minikube.sigs.k8s.io/docs/start/" target="_blank">Официальная документация
                            Minikube</a></li>
                    <li><a href="https://kubernetes.io/ru/docs/setup/learning-environment/minikube/"
                            target="_blank">Установка Minikube</a></li>
                </ul>
            </div>

            <!-- Главный шаг 3 -->
            <button class="accordion"><i class="fas fa-step-forward"></i> Шаг 3: Развёртывание приложения в
                Kubernetes</button>
            <div class="panel">
                <p><strong>На какой машине:</strong> Удалённая машина (FreeBSD виртуальная машина)</p>

                <h3>Описание</h3>
                <p>После установки Kubernetes мы можем развернуть наше первое приложение в кластере.</p>

                <!-- Подшаги -->
                <div class="sub-steps">
                    <!-- Подшаг 1 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Создание файла конфигурации
                        Deployment</button>
                    <div class="sub-panel">
                        <p>Создадим Deployment для развёртывания приложения nginx в кластере.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Создайте директорию для манифестов Kubernetes:</li>
                            <div class="code-block">
                                <pre>
mkdir ~/k8s
cd ~/k8s
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Создайте файл <code>deployment.yaml</code>:</li>
                            <div class="code-block">
                                <pre>
nano deployment.yaml
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Добавьте следующий контент в файл:</li>
                            <div class="code-block">
                                <pre>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
        ports:
        - containerPort: 80
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <h4>Объяснение манифеста</h4>
                            <ul>
                                <li><code>apiVersion</code>: Версия API Kubernetes.</li>
                                <li><code>kind</code>: Тип ресурса, в данном случае Deployment.</li>
                                <li><code>metadata</code>: Метаданные ресурса, включая имя.</li>
                                <li><code>spec</code>: Спецификация Deployment.</li>
                                <li><code>replicas</code>: Количество реплик приложения.</li>
                                <li><code>selector</code>: Метки для выбора подов.</li>
                                <li><code>template</code>: Шаблон для создания подов.</li>
                            </ul>
                            <li>Сохраните файл и выйдите из редактора.</li>
                        </ol>
                    </div>

                    <!-- Подшаг 2 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Применение манифеста
                        Deployment</button>
                    <div class="sub-panel">
                        <p>Развернём наше приложение в кластере с помощью созданного манифеста.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Примените манифест:</li>
                            <div class="code-block">
                                <pre>
kubectl apply -f deployment.yaml
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Проверьте статус Deployment:</li>
                            <div class="code-block">
                                <pre>
kubectl get deployments
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Проверьте созданные поды:</li>
                            <div class="code-block">
                                <pre>
kubectl get pods
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                        </ol>
                    </div>

                    <!-- Подшаг 3 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Создание Service для доступа к
                        приложению</button>
                    <div class="sub-panel">
                        <p>Создадим Service для доступа к приложению извне.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Создайте файл <code>service.yaml</code>:</li>
                            <div class="code-block">
                                <pre>
nano service.yaml
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Добавьте следующий контент в файл:</li>
                            <div class="code-block">
                                <pre>
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: NodePort
  selector:
    app: nginx
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30007
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <h4>Объяснение манифеста</h4>
                            <ul>
                                <li><code>kind: Service</code>: Определяем ресурс типа Service.</li>
                                <li><code>type: NodePort</code>: Делаем сервис доступным через порт узла.</li>
                                <li><code>selector</code>: Указываем метки для подов, к которым будет направлен трафик.
                                </li>
                                <li><code>ports</code>: Определяем порты для доступа.</li>
                            </ul>
                            <li>Сохраните файл и выйдите из редактора.</li>
                            <li>Примените манифест:</li>
                            <div class="code-block">
                                <pre>
kubectl apply -f service.yaml
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Проверьте созданные сервисы:</li>
                            <div class="code-block">
                                <pre>
kubectl get services
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                        </ol>
                    </div>

                    <!-- Подшаг 4 -->
                    <button class="sub-accordion"><i class="fas fa-chevron-right"></i> Тестирование доступа к
                        приложению</button>
                    <div class="sub-panel">
                        <p>Попробуем получить доступ к приложению через веб-браузер.</p>

                        <p><strong>Действия:</strong></p>
                        <ol>
                            <li>Получите IP-адрес Minikube:</li>
                            <div class="code-block">
                                <pre>
minikube ip
                                </pre>
                                <button class="copy-button" onclick="copyCode(this)"><i
                                        class="fas fa-copy"></i></button>
                            </div>
                            <li>Запишите IP-адрес, который выведет команда.</li>
                            <li>Откройте веб-браузер на хостовой машине.</li>
                            <li>Перейдите по адресу <code>http://IP-адрес-Minikube:30007</code>.</li>
                            <li>Вы должны увидеть страницу приветствия Nginx.</li>
                        </ol>

                        <details>
                            <summary><strong>Проблемы с доступом к приложению</strong></summary>
                            <p><strong>Решение:</strong></p>
                            <ul>
                                <li>Убедитесь, что порты не блокируются брандмауэром.</li>
                                <li>Проверьте статус подов и сервисов.</li>
                                <li>Убедитесь, что Minikube работает корректно.</li>
                            </ul>
                        </details>
                    </div>
                </div>

                <h3>Чек-лист: Проверка развёртывания приложения</h3>
                <ul>
                    <li>Deployment и Service успешно созданы и работают.</li>
                    <li>Приложение доступно через веб-браузер.</li>
                </ul>

                <h3>Полезные ссылки</h3>
                <ul>
                    <li><a href="https://kubernetes.io/ru/docs/concepts/workloads/controllers/deployment/"
                            target="_blank">Deployment в Kubernetes</a></li>
                    <li><a href="https://kubernetes.io/ru/docs/concepts/services-networking/service/"
                            target="_blank">Service в Kubernetes</a></li>
                </ul>
            </div>

            <!-- Главный шаг 4 -->
            <button class="accordion"><i class="fas fa-step-forward"></i> Шаг 4: Продолжение изучения
                Kubernetes</button>
            <div class="panel">
                <h3>Описание</h3>
                <p>Теперь, когда вы познакомились с основами установки и работы с Kubernetes на FreeBSD, рекомендуем
                    продолжить изучение:</p>

                <ul>
                    <li>Изучите различные типы контроллеров (DaemonSet, StatefulSet, Job).</li>
                    <li>Изучите системы управления конфигурацией и развертыванием (Helm).</li>
                    <li>Изучите работу с Ingress для маршрутизации трафика.</li>
                    <li>Изучите вопросы безопасности и управление доступом в Kubernetes.</li>
                </ul>

                <h3>Полезные ссылки</h3>
                <ul>
                    <li><a href="https://kubernetes.io/ru/docs/home/" target="_blank">Официальная документация
                            Kubernetes</a></li>
                    <li><a href="https://helm.sh/" target="_blank">Helm — пакетный менеджер для Kubernetes</a></li>
                </ul>
            </div>
        </section>

        <!-- Навигация между шагами -->
        <div class="navigation">
            <!-- Назад к предыдущему шагу по руководству -->
            <a href="../developer/work_with_code.html" class="button"><i class="fas fa-arrow-left"></i> Назад к
                предыдущему шагу по руководству</a>
            <!-- Следующий шаг по руководству -->
            <a href="../devops/traefik_configuration.html" class="button">Следующий шаг руководства: DevOps: Настройка
                Traefik в Kubernetes <i class="fas fa-arrow-right"></i></a>
            <!-- Назад к предыдущему шагу по роли -->
            <a href="../devops/containerization.html" class="button"><i class="fas fa-arrow-left"></i> Назад к
                предыдущему шагу по роли</a>
            <!-- Следующий шаг по роли -->
            <a href="traefik_configuration.html" class="button">Следующий шаг по роли: Настройка Traefik в Kubernetes <i
                    class="fas fa-arrow-right"></i></a>
        </div>

    </main>

    <footer>
        <p>&copy; 2024 | JustUs.uz | Все права защищены</p>
    </footer>

    <script src="../js/scripts.js"></script>
</body>

</html>
